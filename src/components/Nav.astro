---
import { readFileSync } from "node:fs";
import { Icon } from "astro-icon/components";

const lemonLogoSvg = readFileSync("./src/icons/lemon-logo.svg", {
  encoding: "utf8",
});
const { pathname } = Astro.url;
---

<div class="sticky top-4 z-50 mx-auto max-w-[700px] -translate-y-1/2">
  <label
    class="hidden items-center gap-2 rounded-full bg-white px-6 py-3 font-hatch text-xl text-fujo-pink md:hidden"
  >
    <input type="checkbox" class="hidden" />
    <Icon name="lucide:menu" class="inline stroke-2 text-2xl font-bold" />Menu
  </label>
</div>
<nav
  class="small-screen text-fujo-white absolute left-0 right-0 top-0 z-20 flex h-svh flex-col justify-center gap-8 bg-white text-center font-hatch text-3xl md:hidden"
>
  <a
    class:list={{
      current: pathname.startsWith("/projects"),
    }}
    href="/projects">Projects</a
  >
  <a
    class:list={{
      current: pathname.startsWith("/about"),
    }}
    href="/about">About</a
  >
  <a
    class:list={{
      current: pathname.startsWith("/fujoshi"),
    }}
    href="/fujoshi">Fujoshi</a
  >
  <a
    class:list={{
      current: pathname.startsWith("/updates"),
    }}
    href="/updates">Updates</a
  >
  <a
    class:list={{
      current: pathname.startsWith("/support"),
    }}
    href="/support">Support</a
  >
  <div
    class="absolute right-0 top-0 flex items-center gap-2 px-6 py-4 text-2xl"
  >
    <Icon name="lucide:x" class="inline stroke-2 text-2xl font-bold" />CLOSE
  </div>
</nav>
<nav
  class="big-screen sticky top-8 z-30 mt-[var(--content-margin)] hidden w-11/12 -translate-y-1/2 font-hatch text-xl text-fujo-pink md:flex md:transform md:items-center md:justify-around md:rounded-full md:px-2 md:py-1"
>
  <a
    class:list={{
      current: pathname == "/",
    }}
    class="lemon"
    href="/"
    set:html={lemonLogoSvg}
  />
  <a
    class:list={{
      current: pathname.startsWith("/projects"),
    }}
    href="/projects">Projects</a
  >
  <a
    class:list={{
      current: pathname.startsWith("/about"),
    }}
    href="/about">About</a
  >
  <a
    class:list={{
      current: pathname.startsWith("/fujoshi"),
    }}
    href="/fujoshi">Fujoshi</a
  >
  <a
    class:list={{
      current: pathname.startsWith("/updates"),
    }}
    href="/updates">Updates</a
  >
  <a
    class:list={{
      current: pathname.startsWith("/support"),
    }}
    href="/support">Support</a
  >
</nav>

<style>
  nav.big-screen::before {
    background: radial-gradient(circle at center, #4360f7, #70a8e4);
    background-size: 250% 250%;
    content: "";
    position: absolute;
    top: -2px;
    left: -2px;
    right: -2px;
    bottom: -2px;
    z-index: -2;
    @apply rounded-full;
    animation:
      gradient 10s ease infinite,
      shadow linear both;
    animation-timeline: none, scroll(root);
  }
  nav.big-screen::after {
    background: white;
    content: "";
    position: absolute;
    top: 0px;
    left: 0px;
    right: 0px;
    bottom: 0px;
    z-index: -1;
    @apply rounded-full;
  }

  @keyframes gradient {
    0% {
      background-position: 0% 50%;
    }
    50% {
      background-position: 100% 50%;
    }
    100% {
      background-position: 0% 50%;
    }
  }
  a {
    @apply mx-1 my-1 px-4 py-1;
  }
  nav.small-screen a {
    @apply mx-auto my-0 px-8 py-4;
  }
  a:first-child,
  a:nth-child(2) {
    @apply ml-0;
  }
  .current:not(.lemon) {
    @apply rounded-full bg-fujo-blue  text-white;
  }
  a:not(.lemon):hover,
  a.current:hover {
    @apply rounded-full bg-fujo-blue/20  text-fujo-blue backdrop-blur-lg backdrop-filter;
  }
  nav.big-screen {
    animation: pad linear both;
    animation-timeline: scroll();
    animation-range: entry 0% exit 5%;
  }
  .lemon {
    position: absolute;
    left: 5px;
    animation: appear linear both;
    animation-timeline: scroll();
    animation-range: entry 0% exit 5%;
  }

  .lemon :global(svg) {
    width: 25px;
    height: 25px;
    stroke: theme("colors.fujo-pink");
    filter: drop-shadow(2px 2px 3px #ff38eb66);
  }
  .lemon.current :global(svg) {
    fill: #ffc800;
    stroke: black;
    filter: drop-shadow(2px 2px 3px #00000066);
  }
  @keyframes pad {
    from {
      padding-left: 0;
    }
    to {
      padding-left: 55px;
    }
  }
  @keyframes shadow {
    from {
      filter: drop-shadow(0 0 0 #4360f7);
    }
    to {
      filter: drop-shadow(2px 2px 7px #4360f7);
    }
  }
  @keyframes appear {
    from {
      width: 0;
      opacity: 0;
    }
    to {
      width: 20px;
      opacity: 1;
    }
  }
</style>
