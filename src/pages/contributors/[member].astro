---
import type { GetStaticPaths } from "astro";
import { type CollectionEntry, getCollection, getEntry } from "astro:content";
import Layout from "../../layouts/Layout.astro";
import TeamCard from "../../components/team/TeamCard.astro";

export const getStaticPaths: GetStaticPaths = async () => {
  const contributorsCollection = await getCollection("contributors");
  const teamCollection = await getCollection("team");
  // For now we merge them so we get the legacy ones in too
  const team = [
    ...contributorsCollection,
    ...teamCollection.filter(
      (member) =>
        !contributorsCollection.some(
          (contributor) => member.id == contributor.id
        )
    ),
  ];
  return team.map((member, index) => {
    return {
      params: {
        member: member.id,
      },
      props: {
        next: index < team.length - 1 ? team[index + 1].id : null,
        previous: index > 0 ? team[index - 1].id : null,
      },
    };
  });
};

const { member } = Astro.params;
const { previous, next } = Astro.props;

let memberEntry: CollectionEntry<"contributors"> | CollectionEntry<"team"> =
  await getEntry(
    "contributors",
    member as CollectionEntry<"contributors">["id"]
  );

if (!memberEntry) {
  memberEntry = await getEntry("team", member as CollectionEntry<"team">["id"]);
}
---

<Layout title="Fujocoded LLC â€“ Our team">
  <article class="w-full rounded-xl bg-white drop-shadow-purple">
    <a href="/contributors">
      <h1>Our <em>team</em> & contributors</h1>
    </a>
    <div>
      <TeamCard {...memberEntry.data} slug={memberEntry.id} />
      <nav>
        <a
          class:list={{
            disabled: !previous,
          }}
          href={`/contributors/${previous}`}>Previous</a
        >
        <a href="/contributors/">All</a>
        <a
          class:list={{
            hidden: !next,
          }}
          href={`/contributors/${next}`}>Next</a
        >
      </nav>
    </div>
  </article>
</Layout>
<style>
  img {
    max-width: 150px;
    align-self: center;
  }
  ul {
    padding-left: 40px;
  }
  section {
    display: flex;
    flex-direction: column;
    gap: 20px;
  }
  h2 {
    grid-column: span 2;
  }
  article {
    display: flex;
    flex-direction: column;
    gap: 5px;
  }
  nav {
    margin-top: 30px;
    display: flex;
    gap: 15px;
    justify-content: space-evenly;
    width: 100%;
    max-width: 500px;
  }
  div {
    width: 100%;
    display: flex;
    flex-direction: column;
    align-items: center;
  }
  .disabled {
    opacity: 25%;
    pointer-events: none;
  }
</style>
