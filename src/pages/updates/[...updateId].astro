---
import { getCollection } from "astro:content";
import Layout from "../../layouts/Layout.astro";
import { Icon } from "astro-icon/components";
import SubscriptionForm from "../../components/SubscriptionForm.astro";

export async function getStaticPaths() {
  const updates = await getCollection("updates");
  return Promise.all(
    updates.map(async (update) => ({
      params: {
        updateId: update.slug,
      },
      props: {
        Content: (await update.render()).Content,
        data: update.data,
      },
    }))
  );
}

const { Content, data } = Astro.props;
---

<Layout
  title={data.og_title ? data.og_title : `${data.title} â€“ FujoCoded`}
  preview={data.og_image?.src}
  description={data.og_description || data.tagline}
>
  <article class="m-auto rounded-xl bg-white drop-shadow-purple">
    <div class="m-auto mb-8 border-b-2 border-dotted pb-8">
      <date class="mb-2" style="font-variant: small-caps;"
        >{
          data.created_at.toLocaleDateString("en-US", {
            year: "numeric",
            month: "long",
            day: "numeric",
          })
        }</date
      >
      <h1
        class="m-0 mb-1 text-left font-hatch text-[34px] text-fujo-pink"
        set:html={data.title}
      />
      {
        data.tagline && (
          <h2 class="tagline m-0 mb-2 text-left text-[24px] text-slate-500">
            {data.tagline}
          </h2>
        )
      }
    </div>
    <div class="prose prose-lg m-auto mt-4">
      <Content />
    </div>
  </article>
  <aside
    class="mx-auto mt-4 flex flex-col gap-3 rounded-xl bg-white px-6 pb-6 pt-7 drop-shadow-purple sm:px-10"
  >
    {
      !!data.socials.length && (
        <>
          <ul class="flex flex-col gap-2">
            {data.socials.map((contact) => {
              return (
                <li class="flex gap-2">
                  <a href={contact.url}>
                    <Icon
                      size={24}
                      aria-labelledby={
                        contact.platform !== "web" ? "platform" : undefined
                      }
                      aria-label={
                        contact.platform === "web" ? "website" : undefined
                      }
                      name={contact.icon ?? "world-www"}
                    />
                  </a>
                  <a href={contact.url}>
                    {contact.platform === "web" ? (
                      contact.url
                    ) : (
                      <span class="" id="platform">
                        Share on{" "}
                        {`${contact.platform?.charAt(0)}${contact.platform?.slice(1)}`}
                      </span>
                    )}
                  </a>
                </li>
              );
            })}
          </ul>
        </>
      )
    }
    <SubscriptionForm />
  </aside>
</Layout>
